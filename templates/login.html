<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç™»å½•</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <style>
    .login-wrapper { min-height: calc(100vh - var(--header--height)); display: grid; place-items: center; background: var(--surface-bg); }
    .login-card {
      width: min(420px, 92vw);
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: 1.25rem 1.25rem 1.35rem;
      box-shadow: var(--shadow-sm);
    }
    .login-card h1 { margin: 0 0 .75rem; font-size: 1.35rem; }
    .login-card .field { display: grid; gap: .35rem; margin: .85rem 0; }
    .login-card label { font-size: .9rem; color: var(--color-text-alt); }
    .login-card input[type="password"], .login-card input[type="text"] {
      border: 1px solid var(--color-border); border-radius: var(--radius-sm); padding: .6rem .65rem; background: var(--color-bg); color: var(--color-text);
    }
    .login-card .actions { display:flex; gap:.6rem; justify-content:flex-end; margin-top:.85rem; }
    .muted { color: var(--color-text-alt); font-size: .8rem; }
    .error { color: var(--color-danger); font-size: .85rem; margin-top: .25rem; min-height: 1.2em; }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container nav-wrapper">
      <a class="logo" href="index.html">YewFence's <span>Site</span></a>
      <nav id="mainNav" class="nav" aria-label="ä¸»å¯¼èˆª">
        <button class="nav-toggle" id="navToggle" aria-expanded="false" aria-controls="navMenu">â˜°</button>
        <ul id="navMenu" class="nav-menu">
          <li><a href="index.html">é¦–é¡µ</a></li>
          <li><button id="themeSwitcher" class="theme-btn" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="login-wrapper">
    <section class="login-card" aria-label="ç™»å½•é¢æ¿">
      <h1>ç™»å½•</h1>
      <p class="muted">æœ¬é¡µä»…ç”¨äºç«™ç‚¹ç»´æŠ¤äººå‘˜ä½¿ç”¨ã€‚</p>
      <div class="field">
        <label for="password">å¯†ç </label>
        <input id="password" type="password" placeholder="è¾“å…¥å¯†ç " autocomplete="current-password"/>
        <div id="error" class="error"></div>
      </div>
      <div class="actions">
        <button class="btn" id="btnBack">è¿”å›</button>
        <button class="btn primary" id="btnLogin">ç™»å½•</button>
      </div>
      <p class="muted">æç¤ºï¼šæœ¬åŠŸèƒ½çº¯å‰ç«¯å®ç°ï¼Œä¸è¦ç”¨äºæ•æ„Ÿå†…å®¹ã€‚</p>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <p>Â© <span id="year"></span> YewFence.</p>
    </div>
  </footer>

  <button id="backToTop" aria-label="è¿”å›é¡¶éƒ¨" class="back-to-top" hidden>â†‘</button>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script src="js/auth.js"></script>
  <script>
    (async function(){
      const error = document.getElementById('error');
      const passwordInput = document.getElementById('password');
      const btnLogin = document.getElementById('btnLogin');
      const btnBack = document.getElementById('btnBack');

      // åˆå§‹åŒ–é»˜è®¤å¯†ç ï¼ˆä»…é¦–æ¬¡ï¼‰
      await Auth.ensurePasswordInitialized('yewfence');

      btnBack.addEventListener('click', () => {
        window.location.href = 'index.html';
      });

      btnLogin.addEventListener('click', async () => {
        const pw = passwordInput.value.trim();
        if (!pw) { error.textContent = 'è¯·è¾“å…¥å¯†ç '; return; }
        const ok = await Auth.checkPassword(pw);
        if (ok) {
          Auth.setAuthenticated(true);
          window.location.href = 'management.html';
        } else {
          error.textContent = 'å¯†ç é”™è¯¯';
        }
      });

      // å›è½¦æäº¤
      passwordInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') btnLogin.click();
      });
    })();
  </script>
</body>
</html>